!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.safe=n.safe||{})}(this,function(n){"use strict";function t(n){if(Array.isArray(n)){for(var t=0,r=Array(n.length);t<n.length;t++)r[t]=n[t];return r}return Array.from(n)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e="object"===("undefined"==typeof self?"undefined":r(self))&&self.self===self&&self||"object"===("undefined"==typeof global?"undefined":r(global))&&global.global===global&&global||void 0,i=e?e.safe:void 0,o="function"==typeof Symbol&&Symbol.iterator,u=Object.keys,a=Object.prototype.hasOwnProperty,f=Object.prototype.toString,c=function(n){return n&&n.then&&y(n.then)},l=["Array or Object are required","Array is required","Exactly two arguments are required","Function is required"],s={_debugger:!1},p=Array.isArray||function(n){return"[object Array]"===f.call(n)},h=function(n){if(null==n)return!1;var t=void 0===n?"undefined":r(n);return"object"===t||"function"===t},y=function(n){return"[object Function]"===f.call(n)},v=function(n,t){for(var r=0,e=n.length;r<e&&!1!==t(n[r],r);r++);},d=function(n){return n?n.data:void 0},g=function(n){var t=-1,r=n.length;return function(){return++t<r?{value:n[t],key:t}:null}},m=function(n){var t=-1,r=n[o]();return function(){var n=r.next();return n.done?null:{value:n.value,key:++t}}},w=function(n){var t=u(n),r=-1,e=t.length;return function(){var i=t[++r];return r<e?{value:n[i],key:i}:null}},_=function(n){return p(n)?g(n):o&&n[o]?m(n):w(n)},k=function(){return"undefined"===("undefined"==typeof setImmediate?"undefined":r(setImmediate))?"undefined"===("undefined"==typeof process?"undefined":r(process))?"function"===("undefined"==typeof Image?"undefined":r(Image))?function(n){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];if(!y(n))throw new TypeError(l[3]);var i=new Image;i.onerror=function(){n.apply(void 0,r)},i.src="data:image/png,0"}:function(n){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];if(!y(n))throw new TypeError(l[3]);setTimeout.apply(void 0,[n,0].concat(r))}:function(){var n;if(!y(arguments.length<=0?void 0:arguments[0]))throw new TypeError(l[3]);(n=process).nextTick.apply(n,arguments)}:function(){if(!y(arguments.length<=0?void 0:arguments[0]))throw new TypeError(l[3]);setImmediate.apply(void 0,arguments)}}(),b=function(){},A=function(n,t){var r=new TypeError(n);if(!y(t))throw r;t(r)},E=function(n){return function(t){return t(null,n())}},L=function(n){return n=n||null,function(){if(null!==n){var t=n;return n=null,t.apply(void 0,arguments)}}},S=function(n){return function(){if(null===n)throw new Error("Callback was already called.");var t=n;return n=null,t.apply(void 0,arguments)}},j=function(n){return function(){for(var t=!0,r=arguments.length,e=Array(r),i=0;i<r;i++)e[i]=arguments[i];var o=e.pop();e.push(function(){for(var n=this,r=arguments.length,e=Array(r),i=0;i<r;i++)e[i]=arguments[i];t?k(function(){return o.apply(n,e)}):o.apply(this,e)});var u=n.apply(this,e);return t=!1,u}},x=function(n,t){try{var r=n(t);c(r)&&r.then(function(n){return t(null,n)},t)}catch(n){t(n)}},T=function(n,t){var r=n(t);c(r)&&r.then(function(n){return t(null,n)},t)},I=function(n,t){var r=null,e=function(){if(null===t){if(r)throw new Error(r);throw new Error("Callback was already called.")}var n=t;return t=null,n.apply(void 0,arguments)};try{var i=n(e);if(c(i)){if(r="Resolution method is overspecified. Call a callback *or* return a Promise.",null===t)throw new Error(r);i.then(function(n){return e(null,n)},e)}}catch(n){if(null===t)throw n;e(n)}},O=function(n){return function(){for(var t=this,r=arguments.length,e=Array(r),i=0;i<r;i++)e[i]=arguments[i];var o=e.pop();x(function(r){var i=n.apply(t,e);return c(i)?i:r(null,i)},o)}},P=function(n,t){if(!y(t)||!y(n))throw new TypeError(l[2]);return function(r){if(r)n(r);else{var e=void 0;try{for(var i=arguments.length,o=Array(i>1?i-1:0),u=1;u<i;u++)o[u-1]=arguments[u];e=t.apply(this,o)}catch(r){return void n(r)}void 0!==e?k(n,null,e):k(n,null)}}},C=function(n,t){if(void 0===t||!y(n))throw new TypeError(l[2]);return function(r){if(r)n(r);else if(y(t))try{for(var e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];return t.apply(this,i)}catch(r){n(r)}else k(n,null,t)}},q=function(){return Object.create?function(n,t){n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1}})}:function(n,t){function r(){}r.prototype=t.prototype,n.prototype=new r,n.prototype.constructor=t,r.prototype=null}}(),z=function(n,t,r){r=L(r);var e=p(t)?Array(t.length):{};n(t,function(n,t,r){T(n,function(n){for(var i=arguments.length,o=Array(i>1?i-1:0),u=1;u<i;u++)o[u-1]=arguments[u];o.length?e[t]=1===o.length?o[0]:o:e[t]=null,r(n)})},function(n){n?r(n):r(null,e)})},F=function(n,t,r,e,i){if(!p(n))return A(l[1],e);e=L(e);var o=_(n),u=n.length;!function t(a,f){if(a)e(a);else{var c=o();null===c?e(null,f):I(function(t){return r(f,i?c.value:n[u-1-c.key],t)},t)}}(null,t)},Q=function(n,t,r,e){F(n,t,r,e,1)},V=function(n,t,r,e){F(n,t,r,e,0)},D=function(n){return n=parseInt(n)||1/0,function(t,r,e){e=L(e);var i,o=0,u=!1,a=_(t),f=!1,c=function(n){return r(i.value,i.key,n)};!function t(){if(!u&&!f)for(;o<n&&!f;){if(null===(i=a()))return u=!0,void(o<=0&&e(null));++o,I(c,function(n){--o,n?(f=!0,e(n)):!1===u?t():u&&o<=0&&e(null)})}}()}},H=D(1),R=D(1/0),B=function(n){return function(t,r,e){return n(t,e)}},U=function(n,t,r){if(!p(n))return A(l[1],r);R(n,B(t),r)},W=function(n,t,r,e){if(!p(n))return A(l[1],e);D(t)(n,B(r),e)},G=function(n,t,r){if(!p(n))return A(l[1],r);H(n,B(t),r)},J=function(n,t,r){if(!h(n))return A(l[0],r);R(n,t,r)},K=function(n,t,r,e){if(!h(n))return A(l[0],e);D(t)(n,r,e)},M=function(n,t,r){if(!h(n))return A(l[0],r);H(n,t,r)},N=function(n,t,r,e){if(!h(t))return A(l[0],e);e=L(e);var i=p(t)?Array(t.length):[],o=0;n(t,function(n,t,e){var u=o++;T(function(t){return r(n,t)},function(n,t){i[u]=t,e(n)})},function(n){n?e(n):e(null,i)})},X=function(n,t,r,e){if(!h(t))return A(l[0],e);e=L(e);var i={};n(t,function(n,t,e){T(function(e){return r(n,t,e)},function(n,r){i[t]=r,e(n)})},function(n){n?e(n):e(null,i)})},Y=function(n,t,r,e){if(!p(t))return A(l[1],e);e=L(e);var i=Array(t.length);n(t,function(n,t,e){T(function(t){return r(n,t)},function(r,o){i[t]={data:n,i:o},e(r)})},function(n){n?e(n):e(null,i.sort(function(n,t){return n.i-t.i}).map(d))})},Z=function(n,r,e,i){if(!p(r))return A(l[1],i);i=L(i);var o=Array(r.length);n(r,function(n,t,r){T(function(t){return e(n,t)},function(n,e){o[t]=e,r(n)})},function(n){if(n)i(n);else{var r;i(null,(r=[]).concat.apply(r,t(o)))}})},$=function(n,t,r,e){t=parseInt(t);for(var i=Array(t),o=0;o<t;o++)i[o]=o;N(n,i,r,e)},nn=function(n,t,r,e,i){if(!p(r))return A(l[1],i);i=L(i);var o=[];n(r,function(n,r,i){T(function(t){return e(n,t)},function(e,u){(t&&u||!t&&!u)&&o.push({data:n,i:r}),i(e)})},function(n){n?i(n):i(null,o.sort(function(n,t){return n.i-t.i}).map(d))})},tn=function(n,t,r){nn(R,!0,n,t,r)},rn=function(n,t,r,e){nn(D(t),!0,n,r,e)},en=function(n,t,r){nn(H,!0,n,t,r)},on=function(n,t,r,e){e=L(e);var i;n(t,function(n,t,e){T(function(t){return r(n,t)},function(t){t&&(i=n),e(i||null)})},function(){return e(i)})},un=function(n,t,r,e,i){i=L(i);var o=t;n(r,function(n,r,i){T(function(t){return e(n,t)},function(n){t?(n||(o=!1),i(!n)):(n&&(o=!0),i(o))})},function(){return i(o)})},an=function(n,t,r){un(R,!1,n,t,r)},fn=function(n,t,r,e){un(D(t),!1,n,r,e)},cn=function(n,t,r){un(H,!1,n,t,r)},ln=function(n,t,r){un(R,!0,n,t,r)},sn=function(n,t,r,e){un(D(t),!0,n,r,e)},pn=function(n,t,r){un(H,!0,n,t,r)},hn=function(n,t,r,e,i){function o(){I(t,C(i,u))}function u(t){I(n,C(i,function(n){n==r?i(null,t):o()}))}i=L(i),e?u():o()},yn=function(n){return function(t){for(var r=function(){for(var r=this,e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];var u=i.pop();n(t,function(n,t,e){return n.apply(r,i.concat(e))},u)},e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];return 0===i.length?r:r.apply(this,i)}},vn=function(n,t,r){function e(n,e){H(Array(o),function(n,r,a){x(function(n){return t(n,e)},function(n,t){if(i=n||null,e={err:i,result:t},n&&r<o-1)if(u&&!u(n))a(!0);else{var c=f(r+1);c>0?setTimeout(a,c):a()}else a(!n)})},function(){(n||r||b)(i,e)})}if(arguments.length<1||arguments.length>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");var i,o,u,a=0,f=function(n){return a};return y(n)?(r=t,t=n,o=5):h(n)?(o=parseInt(n.times)||5,y(n.interval)?f=n.interval:a=parseInt(n.interval)||a,n.errorFilter&&(u=n.errorFilter)):o=parseInt(o)||5,r?e():e},dn=function(n){return function(){for(var t=arguments.length,r=Array(t),e=0;e<t;e++)r[e]=arguments[e];var i=r.pop();r.push(function(n){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];if(n)i(null,{error:n});else{var o=void 0;o=r.length?1===r.length?r[0]:r:null,i(null,{value:o})}});var o=n.apply(this,r);c(o)&&o.then(function(n){i(null,{value:n})},function(n){i(null,{error:n})})}},gn=function(n,t,r){if(Object.defineProperties?Object.defineProperties(this,{name:{enumerable:!0,configurable:!1,writable:!1,value:r},__worker:{enumerable:!1,configurable:!1,writable:!1,value:n},__workers:{enumerable:!1,configurable:!1,writable:!0,value:0},__workersList:{enumerable:!1,configurable:!1,writable:!0,value:[]},tasks:{enumerable:!1,configurable:!1,writable:!0,value:[]}}):(this.name=r,this.__worker=n,this.__workers=0,this.__workersList=[],this.tasks=[]),null==t&&(t=1),0===(t=parseInt(t)))throw new TypeError("Concurrency must not be zero");this.concurrency=t,this.started=!1,this.paused=!1};gn.prototype.saturated=b,gn.prototype.empty=b,gn.prototype.drain=b,gn.prototype.error=b,gn.prototype.kill=function(){this.drain=b,this.tasks=[]},gn.prototype.length=function(){return this.tasks.length},gn.prototype.running=function(){return this.__workers},gn.prototype.idle=function(){return this.tasks.length+this.__workers===0},gn.prototype.pause=function(){this.paused=!0},gn.prototype.resume=function(){if(!1!==this.paused){this.paused=!1;for(var n=0,t=_(this.tasks);n<this.concurrency&&null!==t();n++)this.__execute()}},gn.prototype.workersList=function(){return this.__workersList},gn.prototype.__insert=function(n,t,r){if(null!=r&&!y(r))throw new TypeError(l[3]);if(this.started=!0,p(n)||(n=[n]),0===n.length)return this.drain();r=y(r)?r:b;var e=n.length,i=0,o=n.map(function(n){return{data:n,priority:t,callback:S(r)}});if("Priority Queue"===this.name){var u=this.tasks.length,a=u?this.tasks[0].priority:0,f=u?this.tasks[u-1].priority:0;t>a?this.tasks.unshift.apply(this.tasks,o):this.tasks.push.apply(this.tasks,o),a>=t&&t<f&&this.tasks.sort(function(n,t){return t.priority-n.priority})}else t?this.tasks.unshift.apply(this.tasks,o):this.tasks.push.apply(this.tasks,o);for(;i<e&&!1!==this.__execute();i++);};var mn=function(n,t){gn.call(this,n,t,"Priority Queue")},wn=function(n,t){gn.call(this,n,t,"Queue")},_n=function(n,t){gn.call(this,n,1,"Cargo"),this.payload=t};q(mn,gn),q(wn,gn),q(_n,gn),mn.prototype.push=function(n,t,r){this.__insert(n,parseInt(t)||0,r)},wn.prototype.push=_n.prototype.push=function(n,t){this.__insert(n,!1,t)},wn.prototype.unshift=function(n,t){this.__insert(n,!0,t)},wn.prototype.__execute=mn.prototype.__execute=function(){var n=this;if(this.paused||this.__workers>=this.concurrency||0===this.tasks.length)return!1;var t=this.tasks.shift();this.__workersList.push(t),0===this.tasks.length&&this.empty();var r=t.data;++this.__workers===this.concurrency&&this.saturated(),I(function(e){return n.__worker.call(t,r,e)},function(){--n.__workers,v(n.__workersList,function(r,e){if(r===t)return n.__workersList.splice(e,1),!1}),t.callback.apply(t,arguments),(arguments.length<=0?void 0:arguments[0])&&n.error(arguments.length<=0?void 0:arguments[0],r),n.idle()&&n.drain(),n.__execute()})},_n.prototype.__execute=function(){var n=this;if(this.paused||this.__workers>=this.concurrency||0===this.tasks.length)return!1;var t=this.tasks.splice(0,this.payload);this.__workersList.push.apply(this.__workersList,t),0===this.tasks.length&&this.empty();var r=t.map(d);++this.__workers===this.concurrency&&this.saturated(),I(function(t){return n.__worker.call(null,r,t)},function(){for(var r=arguments.length,e=Array(r),i=0;i<r;i++)e[i]=arguments[i];--n.__workers,v(t,function(t){v(n.__workersList,function(r,e){if(r===t)return n.__workersList.splice(e,1),!1}),t.callback.apply(t,e)}),n.idle()&&n.drain(),n.__execute()})},n.default={noConflict:function(){return e.safe=i,this},noop:b,yield:function(n){return k(n)},nextTick:"undefined"!==("undefined"==typeof process?"undefined":r(process))&&process.nextTick?process.nextTick:k,back:k,setImmediate:k,apply:function(n){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];return function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return n.apply(void 0,r.concat(e))}},async:function(n,t){for(var r=arguments.length,e=Array(r>2?r-2:0),i=2;i<r;i++)e[i-2]=arguments[i];return function(r){try{return n[t].apply(n,e.concat(r))}catch(n){r(n)}}},inherits:q,args:function(){var n=arguments.length,t=parseInt(this);if(t!==t)throw new Error('Pass arguments to "safe.args" only through ".apply" method!');if(0===n||t>n)return[];for(var r=Array(n-t),e=t;e<n;e++)r[e-t]=e<0?null:arguments[e];return r},ensureAsync:j,setDebugger:function(n){s._debugger=!!y(n)&&n},constant:function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return function(n){return n.apply(void 0,[null].concat(t))}},result:function(n,t){if(!y(t)||!y(n))throw new TypeError(l[2]);return function(){var r;try{for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];r=t.apply(this,i)}catch(t){return void n(t)}void 0!==r?k(n,null,r):k(n,null)}},sure_result:P,trap_sure_result:P,sure:C,trap_sure:C,sure_spread:function(n,t){if(void 0===t||!y(n))throw new TypeError(l[2]);return function(r){if(r)n(r);else try{return t.apply(this,arguments.length<=1?void 0:arguments[1])}catch(r){n(r)}}},spread:function(n){return function(t){return n.apply(this,t)}},trap:function(n,t){if(void 0===n)throw new TypeError(l[2]);return function(){for(var r=arguments.length,e=Array(r),i=0;i<r;i++)e[i]=arguments[i];void 0===t&&(t=n,n=e[e.length-1]);try{return t.apply(this,e)}catch(t){n(t)}}},wrap:function(n,t){if(!y(n)||!y(t))throw new TypeError(l[2]);return function(){for(var r=arguments.length,e=Array(r),i=0;i<r;i++)e[i]=arguments[i];e.push(t);try{return n.apply(this,e)}catch(n){t(n)}}},run:I,each:U,forEach:U,eachLimit:W,forEachLimit:W,eachSeries:G,forEachSeries:G,eachOf:J,forEachOf:J,eachOfLimit:K,forEachOfLimit:K,eachOfSeries:M,forEachOfSeries:M,map:function(n,t,r){N(R,n,t,r)},mapLimit:function(n,t,r,e){N(D(t),n,r,e)},mapSeries:function(n,t,r){N(H,n,t,r)},mapValues:function(n,t,r){X(R,n,t,r)},mapValuesLimit:function(n,t,r,e){X(D(t),n,r,e)},mapValuesSeries:function(n,t,r){X(H,n,t,r)},concat:function(n,t,r){Z(R,n,t,r)},concatLimit:function(n,t,r,e){Z(D(t),n,r,e)},concatSeries:function(n,t,r){Z(H,n,t,r)},sortBy:function(n,t,r){Y(R,n,t,r)},filter:tn,select:tn,filterLimit:rn,selectLimit:rn,filterSeries:en,selectSeries:en,reject:function(n,t,r){nn(R,!1,n,t,r)},rejectLimit:function(n,t,r,e){nn(D(t),!1,n,r,e)},rejectSeries:function(n,t,r){nn(H,!1,n,t,r)},waterfall:function(n,t){if(!h(n))return A(l[0],t);t=L(t);var r=_(n);!function n(e){for(var i=arguments.length,o=Array(i>1?i-1:0),u=1;u<i;u++)o[u-1]=arguments[u];if(e)t(e);else{var a=r();null===a?t.apply(void 0,[null].concat(o)):I(function(n){return a.value.apply(a,o.concat([n]))},n)}}()},series:function(n,t){z(H,n,t)},parallel:function(n,t){z(R,n,t)},parallelLimit:function(n,t,r){z(D(t),n,r)},auto:function(n,t,r){var e,i={},o={},f=0,c=null,l=u(n),s=l.length;if(y(t)?(r=t,t=1/0):t=parseInt(t)||1/0,v(l,function(t){var r=n[t];if(p(r))for(var e,i=0,o=r.length-1;i<o;i++){if(!(e=n[r[i]]))return c=new Error("Has inexistant dependency"),!1;if(e==t||p(e)&&-1!==e.indexOf(t))return c=new Error("Has nonexistent dependency in "+e.join(", ")),!1}}),c){if(y(r))return r(c);throw new Error(c)}r=L(r),function u(){v(l,function(c){if(e||f>=t)return!1;if(!o[c]){var l,h=n[c];if(p(h)){for(var y=h.length-1,v=0;v<y;v++)if(!a.call(i,h[v]))return;l=h[y]}else l=h;o[c]=!0,++f,I(function(n){return l(n,i)},function(n){for(var t=arguments.length,o=Array(t>1?t-1:0),a=1;a<t;a++)o[a-1]=arguments[a];--s,--f,e||(e=n||0===s,n?r(n,i):(o.length?i[c]=1===o.length?o[0]:o:i[c]=null,e?r(n,i):u()))})}})}()},whilst:function(n,t,r){hn(E(n),t,!1,!0,r)},doWhilst:function(n,t,r){hn(E(t),n,!1,!1,r)},during:function(n,t,r){hn(n,t,!1,!0,r)},doDuring:function(n,t,r){hn(t,n,!1,!1,r)},until:function(n,t,r){hn(E(n),t,!0,!0,r)},doUntil:function(n,t,r){hn(E(t),n,!0,!1,r)},forever:function(n,t){t=S(t),n=j(n),function r(){n(C(t,r))}()},reduce:Q,inject:Q,foldl:Q,reduceRight:V,foldr:V,queue:function(n,t){return new wn(n,t)},priorityQueue:function(n,t){return new mn(n,t)},cargo:function(n,t){return new _n(n,t)},retry:vn,retryable:vn,times:function(n,t,r){$(D(n),n,t,r)},timesLimit:function(n,t,r,e){$(D(t),n,r,e)},timesSeries:function(n,t,r){$(H,n,t,r)},detect:function(n,t,r){on(R,n,t,r)},detectLimit:function(n,t,r,e){on(D(t),n,r,e)},detectSeries:function(n,t,r){on(H,n,t,r)},some:an,any:an,someLimit:fn,anyLimit:fn,someSeries:cn,anySeries:cn,every:ln,all:ln,everyLimit:sn,allLimit:sn,everySeries:pn,allSeries:pn,applyEach:yn(R),applyEachSeries:yn(H),asyncify:O,wrapSync:O,memoize:function(n,t){var r={},e={};t=t||function(n){return n};var i=function(){for(var i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];var f=o.pop(),c=t.apply(void 0,o);a.call(r,c)?k(function(){return f.apply(null,r[c])}):a.call(e,c)?e[c].push(f):(e[c]=[f],n.apply(void 0,o.concat([function(){for(var n=arguments.length,t=Array(n),i=0;i<n;i++)t[i]=arguments[i];r[c]=t;var o=e[c];delete e[c],v(o,function(n){n.apply(void 0,t)})}])))};return i.memo=r,i.unmemoized=n,i},unmemoize:function(n){return function(){return(n.unmemoized||n).apply(void 0,arguments)}},transform:function(n,t,r,e){3===arguments.length&&(e=r,r=t,t=p(n)?[]:{}),e=e||b,R(n,function(n,e,i){return r(t,n,e,i)},function(n){return e(n,t)})},reflect:dn,reflectAll:function(n){if(p(n))return n.map(dn);var t={};return v(u(n),function(r){t[r]=dn(n[r])}),t},race:function(n,t){if(!p(n))return A(l[0],t);t=L(t),n.length?v(n,function(n){n(t)}):t()}},Object.keys(n.default).forEach(function(t){n[t]=n.default[t]})});
