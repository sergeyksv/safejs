!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.safe=a.safe||{})}(this,function(a){"use strict";var undefined,b,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},d="undefined",e="object",f="function",g=("undefined"==typeof self?"undefined":c(self))===e&&self.self===self&&self||("undefined"==typeof global?"undefined":c(global))===e&&global.global===global&&global||undefined,h=g?g.safe:undefined,i="function"==typeof Symbol&&Symbol.iterator,j=Object.keys,k=Object.prototype.hasOwnProperty,l=Object.prototype.toString,m=function(a){return a&&s(a.then)},n=["Array or Object are required","Array is required","Exactly two arguments are required","Function is required"],o={"_debugger":!1},p=Array.isArray||function(a){return"[object Array]"===l.call(a)},q=function(a){if(null===a)return!1;var b="undefined"==typeof a?"undefined":c(a);return b===e||b===f},r=function(a){return a===undefined},s=function(a){return("undefined"==typeof a?"undefined":c(a))===f||"[object Function]"===l.call(a)},t=function(a,b){for(var c=0;c<a.length&&b(a[c],c)!==!1;c++);},u=function(a,b){var c=Array(a.length),d=0;if(s(b))for(;d<a.length;d++)c[d]=b(a[d],d,a);else for(;d<a.length;d++)c[d]=a[d]?a[d][b]:undefined;return c},v=function(a){var b,d,e=-1;if(p(a))return b=a.length,function(){return++e,b>e?{"value":a[e],"key":e}:null};if(i&&a[i]){var f=function(){var b=a[i]();return{"v":function(){var a=b.next();return a.done?null:{"value":a.value,"key":++e}}}}();if("object"===("undefined"==typeof f?"undefined":c(f)))return f.v}return d=j(a),b=d.length,function(){var c=d[++e];return b>e?{"value":a[c],"key":c}:null}};b=("undefined"==typeof setImmediate?"undefined":c(setImmediate))===d?("undefined"==typeof process?"undefined":c(process))===d?("undefined"==typeof Promise?"undefined":c(Promise))===f?function(a){var b=0,c=a.resolve();return function(d){10===++b&&(c=a.resolve(),b=0),c.then(function(){d()})}}(Promise):("undefined"==typeof Image?"undefined":c(Image))===f?function(a){return function(b){var c=new a;c.onerror=function(){b()},c.src="data:image/png,0"}}(Image):function(a){setTimeout(a,0)}:process.nextTick:function(a){setImmediate(a)};var w=function(a){for(var c=this,d=arguments.length,e=Array(d>1?d-1:0),f=1;d>f;f++)e[f-1]=arguments[f];b(function(){return a.apply(c,e)})},x=function(){},y=function(a,b){var c=-1!==n.indexOf(a)?new TypeError(a):new Error(a);if(!s(b))throw c;b(c)},z=function(){var a=arguments.length,b=parseInt(this);if(b!==b&&y('Pass arguments to "safe.args" only through ".apply" method!'),0===a||b>a)return[];for(var c=Array(a-b),d=b;a>d;d++)c[d-b]=0>d?null:arguments[d];return c},A=function(a){return function(b){return b(null,a())}},B=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return b.unshift(null),function(a){return a.apply(this,b)}},C=function(a){return a=a||null,function(){if(null!==a){var b=a;a=null;for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return b.apply(this,d)}}},D=function(a){return function(){null===a&&y("Callback was already called.");var b=a;a=null;for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return b.apply(this,d)}},E=function(a){return function(){for(var c=!0,d=arguments.length,e=Array(d),f=0;d>f;f++)e[f]=arguments[f];var g=e.pop();e.push(function(){for(var a=this,d=arguments.length,e=Array(d),f=0;d>f;f++)e[f]=arguments[f];c?b(function(){return g.apply(a,e)}):g.apply(this,e)});var h=a.apply(this,e);return c=!1,h}},F=function(a,b){try{var c=a(b);m(c)&&c.then(function(a){b(null,a)},function(a){b(a)})}catch(d){b(d)}},G=function(a,b){F(a,D(b))},H=function(a){return function(){for(var b=this,c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];var f=d.pop();F(function(c){var e=a.apply(b,d);return m(e)?e:c(null,e)},f)}},I=function(a,b){return s(b)&&s(a)?function(){var c;try{for(var d=arguments.length,e=Array(d),f=0;d>f;f++)e[f]=arguments[f];c=b.apply(this,e)}catch(g){return a(g)}r(c)?w(a,null):w(a,null,c)}:y(n[2])},J=function(a,b){return s(b)&&s(a)?function(c){if(c)return a(c);var d;try{for(var e=arguments.length,f=Array(e>1?e-1:0),g=1;e>g;g++)f[g-1]=arguments[g];d=b.apply(this,f)}catch(c){return a(c)}r(d)?w(a,null):w(a,null,d)}:y(n[2])},K=function(a,b){return r(b)||!s(a)?y(n[2]):function(c){if(c)return a(c);if(!s(b))return w(a,null,b);try{for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;d>f;f++)e[f-1]=arguments[f];return b.apply(this,e)}catch(c){a(c)}}},L=function(a,b){return r(a)?y(n[2]):function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];r(b)&&(b=a,a=d[d.length-1]);try{return b.apply(this,d)}catch(f){a(f)}}},M=function(a,b){return r(b)?y(n[2]):function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];d.push(b);try{return a.apply(this,d)}catch(f){b(f)}}},N=function(a,b){return r(b)||!s(a)?y(n[2]):function(c){if(c)return a(c);try{return b.apply(this,arguments.length<=1?undefined:arguments[1])}catch(c){a(c)}}},O=function(a){return function(b){return a.apply(this,b)}},P=function(){function a(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=b,c.prototype=null}function b(a,b){a.prototype=Object.create(b.prototype,{"constructor":{"value":a,"enumerable":!1}})}return Object.create?b:a}(),Q=function(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;c>e;e++)d[e-2]=arguments[e];return function(c){d.push(c);try{return a[b].apply(a,d)}catch(e){c(e)}}},R=function(a,b,c){c=C(c);var d=p(b)?Array(b.length):{};a(b,function(a,b,c){F(function(b){return a(b)},function(a){for(var e=arguments.length,f=Array(e>1?e-1:0),g=1;e>g;g++)f[g-1]=arguments[g];f.length?d[b]=1===f.length?f[0]:f:d[b]=null,c(a)})},function(a){a?c(a):c(null,d)})},S=function(a,b){if(!q(a))return y(n[0],b);b=C(b);var c=v(a);!function d(a){for(var e=arguments.length,f=Array(e>1?e-1:0),g=1;e>g;g++)f[g-1]=arguments[g];if(a)return b(a);var h=c();return null===h?b.apply(this,arguments):void G(function(a){return f.push(a),h.value.apply(this,f)},d)}()},T=function(a,b,c,d,e){if(!p(a))return y(n[1],d);d=C(d);var f=v(a),g=a.length;!function h(b,i){if(b)return d(b);var j=f();return null===j?d(null,i):void G(function(b){return c(i,e?j.value:a[g-1-j.key],b)},h)}(null,b)},U=function(a,b,c,d){T(a,b,c,d,1)},V=function(a,b,c,d){T(a,b,c,d,0)},W=function(a){return a=parseInt(a)||1/0,function(b,c,d){d=C(d);var e,f=0,g=!1,h=v(b),i=!1,j=2==this?function(a){return c(e.value,a)}:function(a){return c(e.value,e.key,a)};!function k(){if(!g&&!i)for(;a>f;){if(e=h(),null===e)return g=!0,void(0>=f&&d(null));++f,G(j,function(a){--f,a?(i=!0,d(a)):g===!1?k():g&&0>=f&&d(null)})}}()}},X=W(1),Y=W(1/0),Z=function(a,b,c){return p(a)?void Y.call(2,a,b,c):y(n[1],c)},$=function(a,b,c,d){return p(a)?void W(b).call(2,a,c,d):y(n[1],d)},_=function(a,b,c){return p(a)?void X.call(2,a,b,c):y(n[1],c)},aa=function(a,b,c){return q(a,c)?void Y(a,b,c):y(n[0],c)},ba=function(a,b,c,d){return q(a)?void W(b)(a,c,d):y(n[0],d)},ca=function(a,b,c){return q(a)?void X(a,b,c):y(n[0],c)},da=function(a,b,c,d){if(!q(b))return y(n[0],d);d=C(d);var e=p(b)?Array(b.length):[],f=0;a(b,function(a,b,d){var g=f++;F(function(b){return c(a,b)},function(a,b){e[g]=b,d(a)})},function(a){a?d(a):d(null,e)})},ea=function(a,b,c){da(Y,a,b,c)},fa=function(a,b,c,d){da(W(b),a,c,d)},ga=function(a,b,c){da(X,a,b,c)},ha=function(a,b,c,d){if(!p(b))return y(n[1],d);d=C(d);var e=Array(b.length);a(b,function(a,b,d){F(function(b){return c(a,b)},function(c,f){e[b]={"e":a,"i":f},d(c)})},function(a){a?d(a):d(null,u(e.sort(function(a,b){return a.i-b.i}),"e"))})},ia=function(a,b,c,d){if(!p(b))return y(n[1],d);d=C(d);var e=Array(b.length);a(b,function(a,b,d){F(function(b){return c(a,b)},function(a,c){e[b]=c,d(a)})},function(a){if(a)return d(a);var b=[];t(e,function(a){b=b.concat(a)}),d(null,b)})},ja=function(a,b,c,d){b=parseInt(b);for(var e=Array(b),f=0;b>f;f++)e[f]=f;da(a,e,c,d)},ka=function(a,b,c,d,e){if(!p(c))return y(n[1],e);e=C(e);var f=[];a(c,function(a,c,e){F(function(b){return d(a,b)},function(d,g){(b&&g||!b&&!g)&&f.push({"e":a,"i":c}),e(d)})},function(a){a?e(a):e(null,u(f.sort(function(a,b){return a.i-b.i}),"e"))})},la=function(a,b,c){ka(Y,!0,a,b,c)},ma=function(a,b,c,d){ka(W(b),!0,a,c,d)},na=function(a,b,c){ka(X,!0,a,b,c)},oa=function(a,b,c){ka(Y,!1,a,b,c)},pa=function(a,b,c,d){ka(W(b),!1,a,c,d)},qa=function(a,b,c){ka(X,!1,a,b,c)},ra=function(a,b,c,d){d=C(d);var e;a.call(2,b,function(a,b){F(function(b){return c(a,b)},function(c){c&&(e=a),b(e||null)})},function(){d(e)})},sa=function(a,b,c,d,e){e=C(e);var f=b;a.call(2,c,function(a,c){F(function(b){return d(a,b)},function(a){b?(a||(f=!1),c(!a)):(a&&(f=!0),c(f))})},function(){e(f)})},ta=function(a,b,c){sa(Y,!1,a,b,c)},ua=function(a,b,c,d){sa(W(b),!1,a,c,d)},va=function(a,b,c){sa(X,!1,a,b,c)},wa=function(a,b,c){sa(Y,!0,a,b,c)},xa=function(a,b,c,d){sa(W(b),!0,a,c,d)},ya=function(a,b,c){sa(X,!0,a,b,c)},za=function(a,b,c){var d,e={},f={},g=0,h=null,i=j(a),l=i.length;return s(b)?(c=b,b=1/0):b=parseInt(b)||1/0,t(i,function(b){var c=a[b];if(p(c))for(var d,e=0,f=c.length-1;f>e;e++){if(d=a[c[e]],!d)return h="Has inexistant dependency",!1;if(d==b||p(d)&&-1!==d.indexOf(b))return h="Has nonexistent dependency in "+d.join(", "),!1}}),h?y(h,c):(c=C(c),void function m(){t(i,function(h){if(d||g>=b)return!1;if(!f[h]){var i,j=a[h];if(p(j)){for(var n=j.length-1,o=0;n>o;o++)if(!k.call(e,j[o]))return;i=j[n]}else i=j;f[h]=!0,++g,G(function(a){return i(a,e)},function(a){if(--l,--g,!d){if(d=a||0===l,a)return c(a,e);for(var b=arguments.length,f=Array(b>1?b-1:0),i=1;b>i;i++)f[i-1]=arguments[i];return f.length?e[h]=1===f.length?f[0]:f:e[h]=null,d?c(a,e):void m()}})}})}())},Aa=function(a,b,c,d,e){function f(){G(b,K(e,g))}function g(b){G(a,K(e,function(a){a==c?e(null,b):f()}))}e=C(e),d?g():f()},Ba=function(a,b){b=D(b),a=E(a),function c(){a(K(b,c))}()},Ca=function(a){for(var b=this,c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];return function(){for(var c=arguments.length,e=Array(c),f=0;c>f;f++)e[f]=arguments[f];return a.apply(b,d.concat(e))}},Da=function(a){return function(b){for(var c=function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];var f=d.pop();a.call(2,b,function(a,b){return a.apply(this,d.concat(b))},f)},d=arguments.length,e=Array(d>1?d-1:0),f=1;d>f;f++)e[f-1]=arguments[f];return 0===e.length?c:c.apply(this,e)}},Ea=function(a,c){var d={},e={};c=c||function(a){return a};var f=function(){for(var f=arguments.length,g=Array(f),h=0;f>h;h++)g[h]=arguments[h];var i=g.pop(),j=c.apply(null,g);k.call(d,j)?b(function(){i.apply(null,d[j])}):k.call(e,j)?e[j].push(i):(e[j]=[i],a.apply(null,g.concat(function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];d[j]=b;var f=e[j];delete e[j],t(f,function(a){a.apply(null,b)})})))};return f.memo=d,f.unmemoized=a,f},Fa=function(a){return function(){for(var b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];return(a.unmemoized||a).apply(null,c)}},Ga=function(a,b,c){function d(a,d){var h=function(){return g>0?function(a){setTimeout(function(){a()},g)}:function(a){a()}}();X(Array(f),function(a,c,g){F(function(a){return b(a,d)},function(a,b){e=a||null,d={"err":e,"result":b},a&&f-1>c?h(g):g(!a)})},function(){(a||c||x)(e,d)})}if(arguments.length<1||arguments.length>3)return y("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");var e,f,g=0;return s(a)?(c=b,b=a,f=5):q(a)?(f=parseInt(a.times)||5,g=parseInt(a.interval)||0):f=parseInt(f)||5,c?d():d},Ha=function(a,b,c,d){3===arguments.length&&(d=c,c=b,b=p(a)?[]:{}),Y(a,function(a,d,e){c(b,a,d,e)},function(a){d(a,b)})},Ia=function(a){return function(){for(var b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];var e=c.pop();c.push(function(a){if(a)return e(null,{"error":a});for(var b,c=arguments.length,d=Array(c>1?c-1:0),f=1;c>f;f++)d[f-1]=arguments[f];b=d.length?1===d.length?d[0]:d:null,e(null,{"value":b})});var f=a.apply(this,c);m(f)&&f.then(function(a){e(null,{"value":a})},function(a){e(null,{"error":a})})}},Ja=function(a,b){return p(a)?(b=C(b),a.length?void t(a,function(a){a(b)}):b()):y(n[0],b)},Ka=function(a,b){if(Object.defineProperties?Object.defineProperties(this,{"__worker":{"enumerable":!1,"configurable":!1,"writable":!1,"value":a},"__workers":{"enumerable":!1,"configurable":!1,"writable":!0,"value":0},"__workersList":{"enumerable":!1,"configurable":!1,"writable":!0,"value":[]},"tasks":{"enumerable":!1,"configurable":!1,"writable":!0,"value":[]}}):(this.__worker=a,this.__workers=0,this.__workersList=[],this.tasks=[]),null==b)b=1;else{if(0===b)return y("Concurrency must not be zero");this.concurrency=parseInt(b)}this.started=!1,this.paused=!1};Ka.prototype.saturated=x,Ka.prototype.empty=x,Ka.prototype.drain=x,Ka.prototype.kill=function(){this.drain=x,this.tasks=[]},Ka.prototype.length=function(){return this.tasks.length},Ka.prototype.running=function(){return this.__workers},Ka.prototype.idle=function(){return this.tasks.length+this.__workers===0},Ka.prototype.pause=function(){this.paused=!0},Ka.prototype.resume=function(){if(this.paused!==!1){this.paused=!1;for(var a=0,b=v(this.tasks);a<this.concurrency&&null!==b();a++)this.__execute()}},Ka.prototype.workersList=function(){return this.__workersList},Ka.prototype.__insert=function(a,b,d){if(null!=d&&("undefined"==typeof d?"undefined":c(d))!==f)return y(n[3]);if(this.started=!0,p(a)||(a=[a]),0===a.length)return this.drain();var e=a.length,g=this.tasks.length,h=0,i=u(a,function(a){return{"data":a,"priority":b,"callback":D(s(d)?d:x)}});if(g)if(this instanceof La){var j=g?this.tasks[0].priority:0,k=g?this.tasks[g-1].priority:0;b>j?this.tasks=i.concat(this.tasks):this.tasks=this.tasks.concat(i),j>=b&&k>b&&this.tasks.sort(function(a,b){return b.priority-a.priority})}else b?this.tasks=i.concat(this.tasks):this.tasks=this.tasks.concat(i);else this.tasks=i;for(;e>h&&!this.paused;h++)this.__execute()};var La=function(a,b){Ka.call(this,a,b)},Ma=function(a,b){Ka.call(this,a,b)},Na=function(a,b){Ka.call(this,a,1),this.payload=b};P(La,Ka),P(Ma,Ka),P(Na,Ka),La.prototype.push=function(a,b,c){this.__insert(a,b,c)},Ma.prototype.push=Na.prototype.push=function(a,b){this.__insert(a,!1,b)},Ma.prototype.unshift=function(a,b){this.__insert(a,!0,b)},Ma.prototype.__execute=La.prototype.__execute=function(){var a=this;!this.paused&&this.__workers<this.concurrency&&0!==this.tasks.length&&!function(){var b=a.tasks.shift();a.__workersList.push(b),0===a.tasks.length&&a.empty(),++a.__workers,a.__workers===a.concurrency&&a.saturated();var c=D(function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];--a.__workers,t(a.__workersList,function(c,d){return c===b?(a.__workersList.splice(d,1),!1):void 0}),b.callback.apply(b,d),a.tasks.length+a.__workers===0&&a.drain(),a.__execute()});G(function(c){return a.__worker.call(b,b.data,c)},c)}()},Na.prototype.__execute=function(){var a=this;!this.paused&&this.__workers<this.concurrency&&0!==this.tasks.length&&!function(){var b=a.tasks.splice(0,a.payload);0===a.tasks.length&&a.empty();var c=u(b,"data");++a.__workers,a.__workers===a.concurrency&&a.saturated();var d=D(function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];--a.__workers,t(b,function(b){t(a.__workersList,function(c,d){return c===b?(a.__workersList.splice(d,1),!1):void 0}),b.callback.apply(b,d)}),a.tasks.length+a.__workers===0&&a.drain(),a.__execute()});G(function(b){return a.__worker.call(null,c,b)},d)}()};var Oa={"noConflict":function(){return g.safe=h,this},"noop":x,"yield":b,"back":w,"setImmediate":w,"nextTick":w,"apply":Ca,"async":Q,"inherits":P,"args":z,"ensureAsync":E,"setDebugger":function(a){o._debugger=s(a)?a:!1},"constant":B,"result":I,"sure_result":J,"trap_sure_result":J,"sure":K,"trap_sure":K,"trap":L,"wrap":M,"run":G,"sure_spread":N,"spread":O,"each":Z,"forEach":Z,"eachLimit":$,"forEachLimit":$,"eachSeries":_,"forEachSeries":_,"eachOf":aa,"forEachOf":aa,"eachOfLimit":ba,"forEachOfLimit":ba,"eachOfSeries":ca,"forEachOfSeries":ca,"map":ea,"mapLimit":fa,"mapSeries":ga,"concat":function(a,b,c){ia(Y,a,b,c)},"concatLimit":function(a,b,c,d){ia(W(b),a,c,d)},"concatSeries":function(a,b,c){ia(X,a,b,c)},"sortBy":function(a,b,c){ha(Y,a,b,c)},"filter":la,"select":la,"filterLimit":ma,"selectLimit":ma,"filterSeries":na,"selectSeries":na,"reject":oa,"rejectLimit":pa,"rejectSeries":qa,"waterfall":S,"series":function(a,b){R(X,a,b)},"parallel":function(a,b){R(Y,a,b)},"parallelLimit":function(a,b,c){R(W(b),a,c)},"auto":za,"whilst":function(a,b,c){Aa(A(a),b,!1,!0,c)},"doWhilst":function(a,b,c){Aa(A(b),a,!1,!1,c)},"during":function(a,b,c){Aa(a,b,!1,!0,c)},"doDuring":function(a,b,c){Aa(b,a,!1,!1,c)},"until":function(a,b,c){Aa(A(a),b,!0,!0,c)},"doUntil":function(a,b,c){Aa(A(b),a,!0,!1,c)},"forever":Ba,"reduce":U,"inject":U,"foldl":U,"reduceRight":V,"foldr":V,"queue":function(a,b){return new Ma(a,b)},"priorityQueue":function(a,b){return new La(a,b)},"cargo":function(a,b){return new Na(a,b)},"retry":function(a,b,c){return Ga(a,b,c)},"times":function(a,b,c){ja(W(a),a,b,c)},"timesLimit":function(a,b,c,d){ja(W(b),a,c,d)},"timesSeries":function(a,b,c){ja(X,a,b,c)},"detect":function(a,b,c){ra(Y,a,b,c)},"detectLimit":function(a,b,c,d){ra(W(b),a,c,d)},"detectSeries":function(a,b,c){ra(X,a,b,c)},"some":ta,"any":ta,"someLimit":ua,"anyLimit":ua,"someSeries":va,"anySeries":va,"every":wa,"all":wa,"everyLimit":xa,"allLimit":xa,"everySeries":ya,"allSeries":ya,"applyEach":Da(Y),"applyEachSeries":Da(X),"wrapSync":H,"asyncify":H,"memoize":Ea,"unmemoize":Fa,"transform":Ha,"reflect":Ia,"reflectAll":function(a){return u(a,Ia)},"race":Ja};a["default"]=Oa,t(Object.keys(Oa),function(b){a[b]=Oa[b]})});