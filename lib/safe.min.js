!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.safe=a.safe||{})}(this,function(a){"use strict";var undefined,b,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},d="undefined",e="object",f="function",g=("undefined"==typeof self?"undefined":c(self))===e&&self.self===self&&self||("undefined"==typeof global?"undefined":c(global))===e&&global.global===global&&global||undefined,h=g?g.safe:undefined,i="function"==typeof Symbol&&Symbol.iterator,j=Object.keys,k=Object.prototype.hasOwnProperty,l=Object.prototype.toString,m=function(a){return a&&s(a.then)},n=["Array or Object are required","Array is required","Exactly two arguments are required","Function is required"],o={"_debugger":!1},p=Array.isArray||function(a){return"[object Array]"===l.call(a)},q=function(a){if(null===a)return!1;var b="undefined"==typeof a?"undefined":c(a);return b===e||b===f},r=function(a){return a===undefined},s=function(a){return("undefined"==typeof a?"undefined":c(a))===f||"[object Function]"===l.call(a)},t=function(a,b){for(var c=0;c<a.length&&b(a[c],c)!==!1;c++);},u=function(a,b){var c=Array(a.length),d=0;if(s(b))for(;d<a.length;d++)c[d]=b(a[d],d,a);else for(;d<a.length;d++)c[d]=a[d]?a[d][b]:undefined;return c},v=function(a){var b,d,e=-1;if(p(a))return b=a.length,function(){return++e,e<b?{"value":a[e],"key":e}:null};if(i&&a[i]){var f=function(){var b=a[i]();return{"v":function(){var a=b.next();return a.done?null:{"value":a.value,"key":++e}}}}();if("object"===("undefined"==typeof f?"undefined":c(f)))return f.v}return d=j(a),b=d.length,function(){var c=d[++e];return e<b?{"value":a[c],"key":c}:null}};b=("undefined"==typeof setImmediate?"undefined":c(setImmediate))===d?("undefined"==typeof process?"undefined":c(process))===d?("undefined"==typeof Promise?"undefined":c(Promise))===f?function(a){var b=0,c=a.resolve();return function(d){10===++b&&(c=a.resolve(),b=0),c.then(function(){d()})}}(Promise):("undefined"==typeof Image?"undefined":c(Image))===f?function(a){return function(b){var c=new a;c.onerror=function(){b()},c.src="data:image/png,0"}}(Image):function(a){setTimeout(a,0)}:process.nextTick:function(a){setImmediate(a)};var w=function(a){for(var c=this,d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];b(function(){return a.apply(c,e)})},x=function(){},y=function(a,b){var c=n.indexOf(a)!==-1?new TypeError(a):new Error(a);if(!s(b))throw c;b(c)},z=function(){var a=arguments.length,b=parseInt(this);if(b!==b&&y('Pass arguments to "safe.args" only through ".apply" method!'),0===a||b>a)return[];for(var c=Array(a-b),d=b;d<a;d++)c[d-b]=d<0?null:arguments[d];return c},A=function(a){return function(b){return b(null,a())}},B=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return b.unshift(null),function(a){return a.apply(this,b)}},C=function(a){return a=a||null,function(){if(null!==a){var b=a;a=null;for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(this,d)}}},D=function(a){return function(){null===a&&y("Callback was already called.");var b=a;a=null;for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(this,d)}},E=function(a){return function(){for(var c=!0,d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];var g=e.pop();e.push(function(){for(var a=this,d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];c?b(function(){return g.apply(a,e)}):g.apply(this,e)});var h=a.apply(this,e);return c=!1,h}},F=function(a,b){try{var c=a(b);m(c)&&c.then(function(a){return b(null,a)},function(a){return b(a)})}catch(d){b(d)}},G=function(a,b){F(a,D(b))},H=function(a){return function(){for(var b=this,c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];var f=d.pop();F(function(c){var e=a.apply(b,d);return m(e)?e:c(null,e)},f)}},I=function(a,b){return s(b)&&s(a)?function(){var c;try{for(var d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];c=b.apply(this,e)}catch(g){return void a(g)}r(c)?w(a,null):w(a,null,c)}:y(n[2])},J=function(a,b){return s(b)&&s(a)?function(c){if(c)a(c);else{var d=void 0;try{for(var e=arguments.length,f=Array(e>1?e-1:0),g=1;g<e;g++)f[g-1]=arguments[g];d=b.apply(this,f)}catch(c){return void a(c)}r(d)?w(a,null):w(a,null,d)}}:y(n[2])},K=function(a,b){return r(b)||!s(a)?y(n[2]):function(c){if(c)a(c);else if(s(b))try{for(var d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return b.apply(this,e)}catch(c){a(c)}else w(a,null,b)}},L=function(a,b){return r(a)?y(n[2]):function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];r(b)&&(b=a,a=d[d.length-1]);try{return b.apply(this,d)}catch(f){a(f)}}},M=function(a,b){return r(b)?y(n[2]):function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];d.push(b);try{return a.apply(this,d)}catch(f){b(f)}}},N=function(a,b){return r(b)||!s(a)?y(n[2]):function(c){if(c)a(c);else try{return b.apply(this,arguments.length<=1?undefined:arguments[1])}catch(c){a(c)}}},O=function(a){return function(b){return a.apply(this,b)}},P=function(){function a(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=b,c.prototype=null}function b(a,b){a.prototype=Object.create(b.prototype,{"constructor":{"value":a,"enumerable":!1}})}return Object.create?b:a}(),Q=function(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];return function(c){d.push(c);try{return a[b].apply(a,d)}catch(e){c(e)}}},R=function(a,b,c){c=C(c);var d=p(b)?Array(b.length):{};a(b,function(a,b,c){F(function(b){return a(b)},function(a){for(var e=arguments.length,f=Array(e>1?e-1:0),g=1;g<e;g++)f[g-1]=arguments[g];f.length?d[b]=1===f.length?f[0]:f:d[b]=null,c(a)})},function(a){a?c(a):c(null,d)})},S=function(a,b){if(!q(a))return y(n[0],b);b=C(b);var c=v(a);!function d(a){for(var e=this,f=arguments,g=arguments.length,h=Array(g>1?g-1:0),i=1;i<g;i++)h[i-1]=arguments[i];a?b(a):!function(){var a=c();null===a?b.apply(e,f):G(function(b){return h.push(b),a.value.apply(e,h)},d)}()}()},T=function(a,b,c,d,e){if(!p(a))return y(n[1],d);d=C(d);var f=v(a),g=a.length;!function h(b,i){b?d(b):!function(){var b=f();null===b?d(null,i):G(function(d){return c(i,e?b.value:a[g-1-b.key],d)},h)}()}(null,b)},U=function(a,b,c,d){T(a,b,c,d,1)},V=function(a,b,c,d){T(a,b,c,d,0)},W=function(a){return a=parseInt(a)||1/0,function(b,c,d){d=C(d);var e,f=0,g=!1,h=v(b),i=!1,j=function(a){return c(e.value,e.key,a)};!function k(){if(!g&&!i)for(;f<a;){if(e=h(),null===e)return g=!0,void(f<=0&&d(null));++f,G(j,function(a){--f,a?(i=!0,d(a)):g===!1?k():g&&f<=0&&d(null)})}}()}},X=W(1),Y=W(1/0),Z=function(a){return function(b,c,d){return a(b,d)}},$=function(a,b,c){return p(a)?void Y(a,Z(b),c):y(n[1],c)},_=function(a,b,c,d){return p(a)?void W(b)(a,Z(c),d):y(n[1],d)},aa=function(a,b,c){return p(a)?void X(a,Z(b),c):y(n[1],c)},ba=function(a,b,c){return q(a,c)?void Y(a,b,c):y(n[0],c)},ca=function(a,b,c,d){return q(a)?void W(b)(a,c,d):y(n[0],d)},da=function(a,b,c){return q(a)?void X(a,b,c):y(n[0],c)},ea=function(a,b,c,d){if(!q(b))return y(n[0],d);d=C(d);var e=p(b)?Array(b.length):[],f=0;a(b,function(a,b,d){var g=f++;F(function(b){return c(a,b)},function(a,b){e[g]=b,d(a)})},function(a){a?d(a):d(null,e)})},fa=function(a,b,c){ea(Y,a,b,c)},ga=function(a,b,c,d){ea(W(b),a,c,d)},ha=function(a,b,c){ea(X,a,b,c)},ia=function(a,b,c,d){if(!q(b))return y(n[0],d);d=C(d);var e={};a(b,function(a,b,d){F(function(b){return c(a,b)},function(a,c){e[b]=c,d(a)})},function(a){a?d(a):d(null,e)})},ja=function(a,b,c){ia(Y,a,b,c)},ka=function(a,b,c,d){ia(W(b),a,c,d)},la=function(a,b,c){ia(X,a,b,c)},ma=function(a,b,c,d){if(!p(b))return y(n[1],d);d=C(d);var e=Array(b.length);a(b,function(a,b,d){F(function(b){return c(a,b)},function(c,f){e[b]={"e":a,"i":f},d(c)})},function(a){a?d(a):d(null,u(e.sort(function(a,b){return a.i-b.i}),"e"))})},na=function(a,b,c,d){if(!p(b))return y(n[1],d);d=C(d);var e=Array(b.length);a(b,function(a,b,d){F(function(b){return c(a,b)},function(a,c){e[b]=c,d(a)})},function(a){a?d(a):!function(){var a=[];t(e,function(b){return a.push.apply(a,b)}),d(null,a)}()})},oa=function(a,b,c,d){b=parseInt(b);for(var e=Array(b),f=0;f<b;f++)e[f]=f;ea(a,e,c,d)},pa=function(a,b,c,d,e){if(!p(c))return y(n[1],e);e=C(e);var f=[];a(c,function(a,c,e){F(function(b){return d(a,b)},function(d,g){(b&&g||!b&&!g)&&f.push({"e":a,"i":c}),e(d)})},function(a){a?e(a):e(null,u(f.sort(function(a,b){return a.i-b.i}),"e"))})},qa=function(a,b,c){pa(Y,!0,a,b,c)},ra=function(a,b,c,d){pa(W(b),!0,a,c,d)},sa=function(a,b,c){pa(X,!0,a,b,c)},ta=function(a,b,c){pa(Y,!1,a,b,c)},ua=function(a,b,c,d){pa(W(b),!1,a,c,d)},va=function(a,b,c){pa(X,!1,a,b,c)},wa=function(a,b,c,d){d=C(d);var e;a(b,function(a,b,d){F(function(b){return c(a,b)},function(b){b&&(e=a),d(e||null)})},function(){return d(e)})},xa=function(a,b,c,d,e){e=C(e);var f=b;a(c,function(a,c,e){F(function(b){return d(a,b)},function(a){b?(a||(f=!1),e(!a)):(a&&(f=!0),e(f))})},function(){return e(f)})},ya=function(a,b,c){xa(Y,!1,a,b,c)},za=function(a,b,c,d){xa(W(b),!1,a,c,d)},Aa=function(a,b,c){xa(X,!1,a,b,c)},Ba=function(a,b,c){xa(Y,!0,a,b,c)},Ca=function(a,b,c,d){xa(W(b),!0,a,c,d)},Da=function(a,b,c){xa(X,!0,a,b,c)},Ea=function(a,b,c){var d,e={},f={},g=0,h=null,i=j(a),l=i.length;return s(b)?(c=b,b=1/0):b=parseInt(b)||1/0,t(i,function(b){var c=a[b];if(p(c))for(var d,e=0,f=c.length-1;e<f;e++){if(d=a[c[e]],!d)return h="Has inexistant dependency",!1;if(d==b||p(d)&&d.indexOf(b)!==-1)return h="Has nonexistent dependency in "+d.join(", "),!1}}),h?y(h,c):(c=C(c),void function m(){t(i,function(h){if(d||g>=b)return!1;if(!f[h]){var i,j=a[h];if(p(j)){for(var n=j.length-1,o=0;o<n;o++)if(!k.call(e,j[o]))return;i=j[n]}else i=j;f[h]=!0,++g,G(function(a){return i(a,e)},function(a){for(var b=arguments.length,f=Array(b>1?b-1:0),i=1;i<b;i++)f[i-1]=arguments[i];--l,--g,d||(d=a||0===l,a?c(a,e):(f.length?e[h]=1===f.length?f[0]:f:e[h]=null,d?c(a,e):m()))})}})}())},Fa=function(a,b,c,d,e){function f(){G(b,K(e,g))}function g(b){G(a,K(e,function(a){a==c?e(null,b):f()}))}e=C(e),d?g():f()},Ga=function(a,b){b=D(b),a=E(a),function c(){a(K(b,c))}()},Ha=function(a){for(var b=this,c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return function(){for(var c=arguments.length,e=Array(c),f=0;f<c;f++)e[f]=arguments[f];return a.apply(b,d.concat(e))}},Ia=function(a){return function(b){for(var c=function(){for(var c=this,d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];var g=e.pop();a(b,function(a,b,d){return a.apply(c,e.concat(d))},g)},d=arguments.length,e=Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return 0===e.length?c:c.apply(this,e)}},Ja=function(a,c){var d={},e={};c=c||function(a){return a};var f=function(){for(var f=arguments.length,g=Array(f),h=0;h<f;h++)g[h]=arguments[h];var i=g.pop(),j=c.apply(null,g);k.call(d,j)?b(function(){return i.apply(null,d[j])}):k.call(e,j)?e[j].push(i):(e[j]=[i],a.apply(null,g.concat(function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];d[j]=b;var f=e[j];delete e[j],t(f,function(a){a.apply(null,b)})})))};return f.memo=d,f.unmemoized=a,f},Ka=function(a){return function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return(a.unmemoized||a).apply(null,c)}},La=function(a,b,c){function d(a,d){X(Array(f),function(a,c,g){F(function(a){return b(a,d)},function(a,b){if(e=a||null,d={"err":e,"result":b},a&&c<f-1){var i=h(c+1);i>0?setTimeout(g,i):g()}else g(!a)})},function(){(a||c||x)(e,d)})}if(arguments.length<1||arguments.length>3)return y("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");var e,f,g=0,h=function(a){return g};return s(a)?(c=b,b=a,f=5):q(a)?(f=parseInt(a.times)||5,s(a.interval)?h=a.interval:g=parseInt(a.interval)||g):f=parseInt(f)||5,c?d():d},Ma=function(a,b,c,d){3===arguments.length&&(d=c,c=b,b=p(a)?[]:{}),Y(a,function(a,d,e){return c(b,a,d,e)},function(a){return d(a,b)})},Na=function(a){return function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];var e=c.pop();c.push(function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];if(a)e(null,{"error":a});else{var f=void 0;f=c.length?1===c.length?c[0]:c:null,e(null,{"value":f})}});var f=a.apply(this,c);m(f)&&f.then(function(a){e(null,{"value":a})},function(a){e(null,{"error":a})})}},Oa=function(a,b){return p(a)?(b=C(b),void(a.length?t(a,function(a){a(b)}):b())):y(n[0],b)},Pa=function(a,b){if(Object.defineProperties?Object.defineProperties(this,{"__worker":{"enumerable":!1,"configurable":!1,"writable":!1,"value":a},"__workers":{"enumerable":!1,"configurable":!1,"writable":!0,"value":0},"__workersList":{"enumerable":!1,"configurable":!1,"writable":!0,"value":[]},"tasks":{"enumerable":!1,"configurable":!1,"writable":!0,"value":[]}}):(this.__worker=a,this.__workers=0,this.__workersList=[],this.tasks=[]),null==b)b=1;else{if(0===b)return y("Concurrency must not be zero");this.concurrency=parseInt(b)}this.started=!1,this.paused=!1};Pa.prototype.saturated=x,Pa.prototype.empty=x,Pa.prototype.drain=x,Pa.prototype.error=x,Pa.prototype.kill=function(){this.drain=x,this.tasks=[]},Pa.prototype.length=function(){return this.tasks.length},Pa.prototype.running=function(){return this.__workers},Pa.prototype.idle=function(){return this.tasks.length+this.__workers===0},Pa.prototype.pause=function(){this.paused=!0},Pa.prototype.resume=function(){if(this.paused!==!1){this.paused=!1;for(var a=0,b=v(this.tasks);a<this.concurrency&&null!==b();a++)this.__execute()}},Pa.prototype.workersList=function(){return this.__workersList},Pa.prototype.__insert=function(a,b,d){if(null!=d&&("undefined"==typeof d?"undefined":c(d))!==f)return y(n[3]);if(this.started=!0,p(a)||(a=[a]),0===a.length)return this.drain();var e=a.length,g=this.tasks.length,h=0,i=u(a,function(a){return{"data":a,"priority":b,"callback":D(s(d)?d:x)}});if(g)if(this instanceof Qa){var j=g?this.tasks[0].priority:0,k=g?this.tasks[g-1].priority:0;b>j?this.tasks.unshift.apply(this.tasks,i):this.tasks.push.apply(this.tasks,i),j>=b&&b<k&&this.tasks.sort(function(a,b){return b.priority-a.priority})}else b?this.tasks.unshift.apply(this.tasks,i):this.tasks.push.apply(this.tasks,i);else this.tasks=i;for(;h<e&&!this.paused;h++)this.__execute()};var Qa=function(a,b){Pa.call(this,a,b)},Ra=function(a,b){Pa.call(this,a,b)},Sa=function(a,b){Pa.call(this,a,1),this.payload=b};P(Qa,Pa),P(Ra,Pa),P(Sa,Pa),Qa.prototype.push=function(a,b,c){this.__insert(a,b,c)},Ra.prototype.push=Sa.prototype.push=function(a,b){this.__insert(a,!1,b)},Ra.prototype.unshift=function(a,b){this.__insert(a,!0,b)},Ra.prototype.__execute=Qa.prototype.__execute=function(){var a=this;!this.paused&&this.__workers<this.concurrency&&0!==this.tasks.length&&!function(){var b=a.tasks.shift();a.__workersList.push(b),0===a.tasks.length&&a.empty(),++a.__workers,a.__workers===a.concurrency&&a.saturated();var c=D(function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];--a.__workers,t(a.__workersList,function(c,d){if(c===b)return a.__workersList.splice(d,1),!1}),b.callback.apply(b,d),d[0]&&a.error(d[0],b.data),a.idle()&&a.drain(),a.__execute()});G(function(c){return a.__worker.call(b,b.data,c)},c)}()},Sa.prototype.__execute=function(){var a=this;!this.paused&&this.__workers<this.concurrency&&0!==this.tasks.length&&!function(){var b=a.tasks.splice(0,a.payload);0===a.tasks.length&&a.empty();var c=u(b,"data");++a.__workers,a.__workers===a.concurrency&&a.saturated();var d=D(function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];--a.__workers,t(b,function(b){t(a.__workersList,function(c,d){if(c===b)return a.__workersList.splice(d,1),!1}),b.callback.apply(b,d)}),a.idle()&&a.drain(),a.__execute()});G(function(b){return a.__worker.call(null,c,b)},d)}()};var Ta={"noConflict":function(){return g.safe=h,this},"noop":x,"yield":b,"back":w,"setImmediate":w,"nextTick":w,"apply":Ha,"async":Q,"inherits":P,"args":z,"ensureAsync":E,"setDebugger":function(a){o._debugger=!!s(a)&&a},"constant":B,"result":I,"sure_result":J,"trap_sure_result":J,"sure":K,"trap_sure":K,"trap":L,"wrap":M,"run":G,"sure_spread":N,"spread":O,"each":$,"forEach":$,"eachLimit":_,"forEachLimit":_,"eachSeries":aa,"forEachSeries":aa,"eachOf":ba,"forEachOf":ba,"eachOfLimit":ca,"forEachOfLimit":ca,"eachOfSeries":da,"forEachOfSeries":da,"map":fa,"mapLimit":ga,"mapSeries":ha,"mapValues":ja,"mapValuesLimit":ka,"mapValuesSeries":la,"concat":function(a,b,c){na(Y,a,b,c)},"concatLimit":function(a,b,c,d){na(W(b),a,c,d)},"concatSeries":function(a,b,c){na(X,a,b,c)},"sortBy":function(a,b,c){ma(Y,a,b,c)},"filter":qa,"select":qa,"filterLimit":ra,"selectLimit":ra,"filterSeries":sa,"selectSeries":sa,"reject":ta,"rejectLimit":ua,"rejectSeries":va,"waterfall":S,"series":function(a,b){R(X,a,b)},"parallel":function(a,b){R(Y,a,b)},"parallelLimit":function(a,b,c){R(W(b),a,c)},"auto":Ea,"whilst":function(a,b,c){Fa(A(a),b,!1,!0,c)},"doWhilst":function(a,b,c){Fa(A(b),a,!1,!1,c)},"during":function(a,b,c){Fa(a,b,!1,!0,c)},"doDuring":function(a,b,c){Fa(b,a,!1,!1,c)},"until":function(a,b,c){Fa(A(a),b,!0,!0,c)},"doUntil":function(a,b,c){Fa(A(b),a,!0,!1,c)},"forever":Ga,"reduce":U,"inject":U,"foldl":U,"reduceRight":V,"foldr":V,"queue":function(a,b){return new Ra(a,b)},"priorityQueue":function(a,b){return new Qa(a,b)},"cargo":function(a,b){return new Sa(a,b)},"retry":La,"times":function(a,b,c){oa(W(a),a,b,c)},"timesLimit":function(a,b,c,d){oa(W(b),a,c,d)},"timesSeries":function(a,b,c){oa(X,a,b,c)},"detect":function(a,b,c){wa(Y,a,b,c)},"detectLimit":function(a,b,c,d){wa(W(b),a,c,d)},"detectSeries":function(a,b,c){wa(X,a,b,c)},"some":ya,"any":ya,"someLimit":za,"anyLimit":za,"someSeries":Aa,"anySeries":Aa,"every":Ba,"all":Ba,"everyLimit":Ca,"allLimit":Ca,"everySeries":Da,"allSeries":Da,"applyEach":Ia(Y),"applyEachSeries":Ia(X),"wrapSync":H,"asyncify":H,"memoize":Ja,"unmemoize":Ka,"transform":Ma,"reflect":Na,"reflectAll":function(a){var b;return p(a)?b=u(a,Na):(b={},t(j(a),function(c){b[c]=Na(a[c])})),b},"race":Oa};a["default"]=Ta,t(Object.keys(Ta),function(b){a[b]=Ta[b]})});